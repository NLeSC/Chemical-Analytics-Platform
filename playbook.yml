---
- hosts: all
  tasks:
    # desktop
    - name: Add cinnamon desktop environment repo
      apt_repository: repo='ppa:lestcape/cinnamon' state=present update_cache=yes
    - name: ensure cinnamon desktop environment is installed
      apt: pkg=cinnamon state=latest
    - apt: pkg=mdm state=latest
    # make cinnamon start at boot
    - name: autologin user
      ini_file: dest=/etc/mdm/mdm.conf section=daemon option={{ item.option }} value={{ item.value }} with_items:
        - { option: 'AutomaticLoginEnable', value: 'true'}
        - { option: 'AutomaticLogin', value: 'vagrant'}
    # chem tools
    - name: chem tools
      apt: pkg={{ item }} state=latest with_items:
        - openbabel
        - viewmol
        - xdrawchem
    # wiki
    - user: name=gollum state=present
    - name: dependencies for gollum
      apt: pkg={{ item }} state=latest with_items:
        - ruby-dev
        - libicu-dev
        - zlib1g-dev
        - build-essential
        - git
    - gem: name=gollum state=present
    - git: repo=https://github.com/NLeSC/Chemical-Analytics-Platform.wiki.git dest=/opt/wiki
    - file: owner=gollum path=/opt/wiki recurse=yes
    # Start/stop for gollum
    # knime
    - get_url: url=http://download.knime.org/analytics-platform/linux/knime-full_2.12.0.linux.gtk.x86_64.tar.gz dest=/opt/knime.tar.gz mode=0440
    - file: path=/opt/knime state=directory mode=0755
    - unarchive: src=/opt/knime.tar.gz dest=/opt/knime copy=no creates=/opt/knime/knime-full_2.12.0
    - file: src=/opt/knime/knime-full_2.12.0/knime dest=/usr/bin/knime state=link
    - name: Knime desktop icon
      copy: src=files/knime.desktop dest=/usr/share/applications/knime.desktop
